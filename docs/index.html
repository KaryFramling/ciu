<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Contextual Importance and Utility • ciu</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Contextual Importance and Utility">
<meta property="og:description" content="Implementation of the Contextual Importance and Utility 
    (CIU) concepts for Explainable AI (XAI). A recent description of CIU
    can be found in e.g. Främling (2020) &lt;arXiv:2009.13996&gt;.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">ciu</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.6.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">

<div class="section level1">
<div class="page-header"><h1 id="ciu">ciu<a class="anchor" aria-label="anchor" href="#ciu"></a>
</h1></div>
<p>This is an R implementation of the Contextual Importance and Utility (CIU) method for Explainable AI (XAI). CIU was developed by Kary Främling in his PhD thesis <em>Learning and Explaining Preferences with Neural Networks for Multiple Criteria Decision Making</em>, (written in French, title <em>Modélisation et apprentissage des préférences par réseaux de neurones pour l’aide à la décision multicritère</em>), available online for instance here: <a href="https://tel.archives-ouvertes.fr/tel-00825854/document" class="external-link uri">https://tel.archives-ouvertes.fr/tel-00825854/document</a>. It was originally implemented in Matlab.</p>
</div>
<div class="section level1">
<h1 id="what-is-ciu">What is CIU?<a class="anchor" aria-label="anchor" href="#what-is-ciu"></a>
</h1>
<p><strong>Remark</strong>: It seems like Github Markdown doesn’t show correctly the “{” and “}” characters in Latex equations, whereas they are shown correctly in Rstudio. Therefore, in most cases where there is an <span class="math inline"><em>i</em></span> shown in Github, it actually signifies <code>{i}</code> and where there is an <span class="math inline"><em>I</em></span> it signifies <code>{I}</code>.</p>
<p>CIU is a model-agnostic method for producing outcome explanations of results of any “black-box” model <code>y=f(x)</code>. CIU directly estimates two elements of explanation by observing the behaviour of the black-box model (without creating any “surrogate” model <code>g</code> of <code>f(x)</code>).</p>
<p><strong>Contextual Importance (CI)</strong> answers the question: <em>how much can the result (or the utility of it) change as a function of feature</em> <span class="math inline"><em>i</em></span> or a set of features <span class="math inline">{<em>i</em>}</span> jointly, in the context <span class="math inline"><em>x</em></span>?</p>
<p><strong>Contextual Utility (CU)</strong> answers the question: <em>how favorable is the value of feature</em> <span class="math inline"><em>i</em></span> (or a set of features <span class="math inline">{<em>i</em>}</span> jointly) for a good (high-utility) result, in the context <span class="math inline"><em>x</em></span>?</p>
<p>CI of one feature or a set of features (jointly) <span class="math inline">{<em>i</em>}</span> compared to a superset of features <span class="math inline">{<em>I</em>}</span> is defined as</p>
<p><span class="math display">$$
\omega_{j,\{i\},\{I\}}(x)=\frac{umax_{j}(x,\{i\})-umin_{j}(x,\{i\})}{umax_{j}(x,\{I\})-umin_{j}(x,\{I\})},  
$$</span></p>
<p>where <span class="math inline">{<em>i</em>} ⊆ {<em>I</em>}</span> and <span class="math inline">{<em>I</em>} ⊆ {1, …, <em>n</em>}</span>. <span class="math inline"><em>x</em></span> is the instance/context to be explained and defines the values of input features that do not belong to <span class="math inline">{<em>i</em>}</span> or <span class="math inline">{<em>I</em>}</span>. In practice, CI is calculated as:</p>
<p><span class="math display">$$
\omega_{j,\{i\},\{I\}}(x)= \frac{ymax_{j,\{i\}}(x)-ymin_{j,\{i\}}(x)}{ ymax_{j,\{I\}}(x)-ymin_{j,\{I\}}(x)}, 
$$</span></p>
<p>where <span class="math inline"><em>y</em><em>m</em><em>i</em><em>n</em><sub><em>j</em></sub>()</span> and <span class="math inline"><em>y</em><em>m</em><em>a</em><em>x</em><sub><em>j</em></sub>()</span> are the minimal and maximal <span class="math inline"><em>y</em><sub><em>j</em></sub></span> values observed for output <span class="math inline"><em>j</em></span>.</p>
<p>CU is defined as</p>
<p><span class="math display">$$
CU_{j,\{i\}}(x)=\frac{u_{j}(x)-umin_{j,\{i\}}(x)}{umax_{j,\{i\}}(x)-umin_{j,\{i\}}(x)}. 
$$</span></p>
<p>When <span class="math inline"><em>u</em><sub><em>j</em></sub>(<em>y</em><sub><em>j</em></sub>) = <em>A</em><em>y</em><sub><em>j</em></sub> + <em>b</em></span>, this can be written as:</p>
<p><span class="math display">$$
CU_{j,\{i\}}(x)=\left|\frac{ y_{j}(x)-yumin_{j,\{i\}}(x)}{ymax_{j,\{i\}}(x)-ymin_{j,\{i\}}(x)}\right|, 
$$</span></p>
<p>where <span class="math inline"><em>y</em><em>u</em><em>m</em><em>i</em><em>n</em> = <em>y</em><em>m</em><em>i</em><em>n</em></span> if <span class="math inline"><em>A</em></span> is positive and <span class="math inline"><em>y</em><em>u</em><em>m</em><em>i</em><em>n</em> = <em>y</em><em>m</em><em>a</em><em>x</em></span> if <span class="math inline"><em>A</em></span> is negative.</p>
</div>
<div class="section level1">
<h1 id="classification-example-titanic">Classification Example: Titanic<a class="anchor" aria-label="anchor" href="#classification-example-titanic"></a>
</h1>
<p>The Titanic data set is a classification task with classes <code>yes' or</code>no’ for the probability of survival. Our Random Forest model achieved 81.1% classification accuracy on the test set. The studied instance `Johnny D’ (an 8-year old boy traveling alone) and model are the same as used in <em>Przemyslaw Biecek and Tomasz Burzykowski. Explanatory Model Analysis. Chapman and Hall/CRC, New York, 2021</em>.</p>
<p>First load necessary packages:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Necessary packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.stat.berkeley.edu/~breiman/RandomForests/" class="external-link">randomForest</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/topepo/caret/" class="external-link">caret</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://modeloriented.github.io/DALEX/" class="external-link">"DALEX"</a></span><span class="op">)</span></span></code></pre></div>
<p>Train Random Forest model:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">ciu</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Ensure some repeatability.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">32</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Some pre-processing</span></span>
<span><span class="va">titanic_train</span> <span class="op">&lt;-</span> <span class="va">titanic</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"survived"</span>, <span class="st">"class"</span>, <span class="st">"gender"</span>, <span class="st">"age"</span>, <span class="st">"sibsp"</span>, <span class="st">"parch"</span>, <span class="st">"fare"</span>, <span class="st">"embarked"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">titanic_train</span><span class="op">$</span><span class="va">survived</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">titanic_train</span><span class="op">$</span><span class="va">survived</span><span class="op">)</span></span>
<span><span class="va">titanic_train</span><span class="op">$</span><span class="va">gender</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">titanic_train</span><span class="op">$</span><span class="va">gender</span><span class="op">)</span></span>
<span><span class="va">titanic_train</span><span class="op">$</span><span class="va">embarked</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">titanic_train</span><span class="op">$</span><span class="va">embarked</span><span class="op">)</span></span>
<span><span class="va">titanic_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="va">titanic_train</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Train with caret/Random Forest (we don't care about train/test set for this example)</span></span>
<span><span class="va">kfoldcv</span> <span class="op">&lt;-</span> <span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html" class="external-link">trainControl</a></span><span class="op">(</span>method<span class="op">=</span><span class="st">"cv"</span>, number<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">model_rf</span> <span class="op">&lt;-</span> <span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html" class="external-link">train</a></span><span class="op">(</span><span class="va">survived</span> <span class="op">~</span> <span class="va">.</span>, <span class="va">titanic_train</span>, method<span class="op">=</span><span class="st">"rf"</span>, trControl<span class="op">=</span><span class="va">kfoldcv</span><span class="op">)</span></span></code></pre></div>
<p>Create instance, CIU object and explain.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create test instance (8-year old boy)</span></span>
<span><span class="va">new_passenger</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    class <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="st">"1st"</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1st"</span>, <span class="st">"2nd"</span>, <span class="st">"3rd"</span>, <span class="st">"deck crew"</span>, <span class="st">"engineering crew"</span>, <span class="st">"restaurant staff"</span>, <span class="st">"victualling crew"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    gender <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="st">"male"</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"female"</span>, <span class="st">"male"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    age <span class="op">=</span> <span class="fl">8</span>,</span>
<span>    sibsp <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    parch <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    fare <span class="op">=</span> <span class="fl">72</span>,</span>
<span>    embarked <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="st">"Cherbourg"</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Belfast"</span>, <span class="st">"Cherbourg"</span>, <span class="st">"Queenstown"</span>, <span class="st">"Southampton"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create CIU object and get barplot explanation</span></span>
<span><span class="va">ciu</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ciu.new.html">ciu.new</a></span><span class="op">(</span><span class="va">model_rf</span>, <span class="va">survived</span><span class="op">~</span><span class="va">.</span>, <span class="va">titanic_train</span><span class="op">)</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="va">ciu</span><span class="op">$</span><span class="fu">ggplot.col.ciu</span><span class="op">(</span><span class="va">new_passenger</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-2-1.png"><!-- --></p>
<p>This CIU bar plot explanation “explains” the probability of survival, which is 63.6%, as well as the probability of non-survival. The bar lengths show she CI value and the bar color corresponds to the CU value.</p>
<p>The <code>ciu</code> package provides numerous visualization possibilities. The plot above is produced using <code>ggplot</code> but there are also methods/functions that use R’s standard (old) plot functionality. In practice, it seems like a more clearly “counter-factual” explanation is more easily understood, as produced by the following code:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">ciu</span><span class="op">$</span><span class="fu">ggplot.col.ciu</span><span class="op">(</span><span class="va">new_passenger</span>, output.names <span class="op">=</span> <span class="st">"yes"</span>, plot.mode <span class="op">=</span> <span class="st">"overlap"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-3-1.png"><!-- --></p>
<p>In this plot, the transparent bar shows the CI value, <em>i.e.</em> how much the result could change with a different value than the current one. The solid part shows how “good” the current value is (CU). This explanation can be considered counter-factual (what-if) because it <em>e.g.</em>shows that being accompanied by even one parent would significantly increase the probability of survival (the feature <span class="math inline"><em>p</em><em>a</em><em>r</em><em>c</em><em>h</em></span>).</p>
<p>For one input feature, it is easy to see exactly how both CI and CU values are calculated, as shown by the following call and plot (the red dot shows the value for instance <span class="math inline"><em>x</em></span>):</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">ciu</span><span class="op">$</span><span class="fu">ggplot.ciu</span><span class="op">(</span><span class="va">new_passenger</span>, ind.input <span class="op">=</span> <span class="fl">3</span>, ind.output <span class="op">=</span> <span class="fl">2</span>, illustrate.CIU <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/titanic_age-1.png"><!-- --></p>
<p>It is also possible to obtain textual explanations:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">ciu</span><span class="op">$</span><span class="fu">textual</span><span class="op">(</span><span class="va">new_passenger</span>, ind.output <span class="op">=</span> <span class="fl">2</span>, use.text.effects <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="do">## The value of output 'yes' for instance '1' is 0.666, which is good (CU=0.666).</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Feature 'age' is very important (CI=0.708) and value '8' is very good (CU=0.87).</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Feature 'sibsp' is slightly important (CI=0.326) and value '0' is very good (CU=1).</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Feature 'gender' is slightly important (CI=0.278) and value 'male' is very bad (CU=0).</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Feature 'parch' is slightly important (CI=0.224) and value '0' is very bad (CU=0).</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Feature 'class' is not important (CI=0.198) and value '1st' is good (CU=0.717).</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Feature 'fare' is not important (CI=0.17) and value '72' is average (CU=0.541).</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Feature 'embarked' is not important (CI=0.076) and value 'Cherbourg' is very good (CU=1).</span></span></code></pre></div>
<p>Raw CIU values (for ine feature/input) can be obtained by the “explain” function:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ciu</span><span class="op">$</span><span class="fu">explain</span><span class="op">(</span><span class="va">new_passenger</span>, ind.inputs.to.explain <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="do">##        CI        CU  cmin  cmax outval</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="do">## no  0.708 0.1299435 0.242 0.950  0.334</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="do">## yes 0.708 0.8700565 0.050 0.758  0.666</span></span></code></pre></div>
<p>The <code>meta.explain</code> method returns an “explanation object” that can also be passed as a parameter to the plotting/textual functions in order to evaluate the explanation only once:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mciu</span> <span class="op">&lt;-</span> <span class="va">ciu</span><span class="op">$</span><span class="fu">meta.explain</span><span class="op">(</span><span class="va">new_passenger</span><span class="op">)</span></span>
<span><span class="co"># Display result values for all inputs</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">mciu</span><span class="op">$</span><span class="va">ciuvals</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="do">## $class</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="do">##        CI        CU  cmin  cmax outval</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="do">## no  0.198 0.2828283 0.278 0.476  0.334</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="do">## yes 0.198 0.7171717 0.524 0.722  0.666</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="do">## $gender</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="do">##        CI CU  cmin  cmax outval</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="do">## no  0.278  1 0.056 0.334  0.334</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="do">## yes 0.278  0 0.666 0.944  0.666</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="do">## $age</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="do">##        CI        CU  cmin  cmax outval</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="do">## no  0.708 0.1299435 0.242 0.950  0.334</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="do">## yes 0.708 0.8700565 0.050 0.758  0.666</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="do">## $sibsp</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="do">##        CI CU  cmin  cmax outval</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="do">## no  0.326  0 0.334 0.660  0.334</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="do">## yes 0.326  1 0.340 0.666  0.666</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="do">## $parch</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a><span class="do">##        CI CU  cmin  cmax outval</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a><span class="do">## no  0.224  1 0.110 0.334  0.334</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a><span class="do">## yes 0.224  0 0.666 0.890  0.666</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a><span class="do">## $fare</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a><span class="do">##        CI        CU  cmin  cmax outval</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a><span class="do">## no  0.162 0.4320988 0.264 0.426  0.334</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a><span class="do">## yes 0.162 0.5679012 0.574 0.736  0.666</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a><span class="do">## $embarked</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a><span class="do">##        CI CU  cmin  cmax outval</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a><span class="do">## no  0.076  0 0.334 0.410  0.334</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a><span class="do">## yes 0.076  1 0.590 0.666  0.666</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># More practical to use ciu.list.to.frame (out.ind=2 corresponds to "yes" for Titanic):</span></span>
<span><span class="fu"><a href="reference/ciu.list.to.frame.html">ciu.list.to.frame</a></span><span class="op">(</span><span class="va">mciu</span><span class="op">$</span><span class="va">ciuvals</span>, out.ind <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="do">##      CI        CU  cmin  cmax outval</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 0.198 0.7171717 0.524 0.722  0.666</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 0.278 0.0000000 0.666 0.944  0.666</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 0.708 0.8700565 0.050 0.758  0.666</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 0.326 1.0000000 0.340 0.666  0.666</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 5 0.224 0.0000000 0.666 0.890  0.666</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 6 0.162 0.5679012 0.574 0.736  0.666</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 7 0.076 1.0000000 0.590 0.666  0.666</span></span></code></pre></div>
<div class="section level2">
<h2 id="contextual-influence">Contextual influence<a class="anchor" aria-label="anchor" href="#contextual-influence"></a>
</h2>
<p>The yellow/orange <span class="math inline"><em>y</em>(<em>u</em>(0))</span> line shown in the plot above is related to what is called Contextual influence and can be calculated from CI and CU as follows:</p>
<p><span class="math display"><em>ϕ</em><sub><em>j</em>, {<em>i</em>}, {<em>I</em>}</sub>(<em>x</em>) = <em>ω</em><sub><em>j</em>, {<em>i</em>}, {<em>I</em>}</sub>(<em>x</em>)(<em>C</em><em>U</em><sub><em>j</em>, {<em>i</em>}</sub>(<em>x</em>)−<em>ϕ</em><sub>0</sub>),</span></p>
<p>where <span class="math inline"><em>ϕ</em><sub>0</sub></span> is the <em>baseline/reference</em> value (<span class="math inline"><em>y</em>(<em>u</em>(0))</span> in the plot). For instance, <span class="math inline"><em>ϕ</em><sub>0</sub> = 0.5</span> signifies using the average utility value <span class="math inline">0.5</span> as the baseline, which is the case in the <span class="math inline"><em>a</em><em>g</em><em>e</em></span> plot above. An explanation using Contextual influence can be obtained as follows:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">ciu</span><span class="op">$</span><span class="fu">ggplot.col.ciu</span><span class="op">(</span><span class="va">new_passenger</span>, output.names <span class="op">=</span> <span class="st">"yes"</span>, use.influence <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient</a></span><span class="op">(</span>low<span class="op">=</span><span class="st">"firebrick"</span>, high<span class="op">=</span><span class="st">"steelblue"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span><span class="st">""</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">phi</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/contextual_influence_titanic-1.png"><!-- --></p>
<p><strong>Remark:</strong> The Equation for Contextual influence is similar to the definition of Shapley values for linear models, except that the input value <span class="math inline"><em>x</em><sub><em>i</em></sub></span> is replaced by its utility value(s) <span class="math inline"><em>C</em><em>U</em><sub><em>j</em>, {<em>i</em>}</sub>(<em>x</em>)</span>. In practice, <strong>all <em>Additive Feature Attribution (AFA)</em> methods estimate influence values, not feature importance. Most state-of-the-art methods such as <em>Shapley values</em>, <em>LIME</em>,</strong> are AFA methods.</p>
<p>Influence values give no counter-factual information and are easily misinterpreted. Below, we create a Shapley value explanation using the IML package. In that explanation, for instance the close-to-zero Shapley value for <span class="math inline"><em>p</em><em>a</em><em>r</em><em>c</em><em>h</em></span> gives the impression that it’s a non-important feature, which is clearly wrong based on the CIU explanation.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://christophm.github.io/iml/" class="external-link">iml</a></span><span class="op">)</span></span>
<span><span class="va">predictor</span> <span class="op">&lt;-</span> <span class="va"><a href="https://christophm.github.io/iml/reference/Predictor.html" class="external-link">Predictor</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">model_rf</span>, data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">titanic_train</span>, select<span class="op">=</span><span class="op">-</span><span class="va">survived</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">titanic_train</span><span class="op">[</span>,<span class="st">"survived"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">shapley</span> <span class="op">&lt;-</span> <span class="va"><a href="https://christophm.github.io/iml/reference/Shapley.html" class="external-link">Shapley</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">predictor</span>, x.interest <span class="op">=</span> <span class="va">new_passenger</span><span class="op">)</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="va">shapley</span><span class="op">$</span><span class="va">results</span>; <span class="va">d</span> <span class="op">&lt;-</span> <span class="va">d</span><span class="op">[</span><span class="va">d</span><span class="op">$</span><span class="va">class</span><span class="op">==</span><span class="st">'yes'</span>,<span class="op">]</span>; <span class="va">d</span><span class="op">$</span><span class="va">sign</span> <span class="op">&lt;-</span> <span class="va">d</span><span class="op">$</span><span class="va">phi</span><span class="op">&gt;=</span><span class="fl">0</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html" class="external-link">reorder</a></span><span class="op">(</span><span class="va">feature.value</span>, <span class="va">phi</span><span class="op">)</span>, y<span class="op">=</span><span class="va">phi</span>, fill<span class="op">=</span><span class="va">sign</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span><span class="st">""</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">phi</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span><span class="st">"legend"</span>, values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"FALSE"</span> <span class="op">=</span> <span class="st">"firebrick"</span>, <span class="st">"TRUE"</span> <span class="op">=</span> <span class="st">"steelblue"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/shapley_titanic-1.png"><!-- --></p>
<p>It might be worth mentioning also that the Shapley value explanation has a much greater variance than the CIU (and Contextual influence) explanation with same number of samples. This is presumably due to the fundamental difference between estimating min/max output values for CIU, compared to estimating a kind of gradient with AFA methods.</p>
</div>
</div>
<div class="section level1">
<h1 id="intermediate-concepts">Intermediate Concepts<a class="anchor" aria-label="anchor" href="#intermediate-concepts"></a>
</h1>
<p>CIU can use named feature coalitions and structured vocabularies. Such vocabularies allow explanations at any abstraction level and can make explanations interactive.</p>
<p>The following code snippet plots the joint effect of features <span class="math inline"><em>a</em><em>g</em><em>e</em></span> and <span class="math inline"><em>p</em><em>a</em><em>r</em><em>c</em><em>h</em></span> for the studied Titanic case (applicable for numeric features). It therefore shows how the coalition of those two features affects the output vqlue and how CI and CU can be deduced in the same way as for a single feature.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ciu</span><span class="op">$</span><span class="fu">plot.ciu.3D</span><span class="op">(</span><span class="va">new_passenger</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">3</span><span class="op">)</span>, ind.output <span class="op">=</span> <span class="fl">2</span>, theta <span class="op">=</span> <span class="fl">50</span>, phi <span class="op">=</span> <span class="fl">10</span>, </span>
<span>                col <span class="op">=</span> <span class="st">"lightblue"</span>, ltheta <span class="op">=</span> <span class="fl">120</span>, shade <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-6-1.png"><!-- --></p>
<p>We define a small vocabulary for Titanic as follows:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wealth</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">6</span><span class="op">)</span>; <span class="va">family</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">5</span><span class="op">)</span>; <span class="va">gender</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>; <span class="va">age</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span>; <span class="va">embarked</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7</span><span class="op">)</span></span>
<span><span class="va">Titanic.voc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"WEALTH"</span><span class="op">=</span><span class="va">wealth</span>, <span class="st">"FAMILY"</span><span class="op">=</span><span class="va">family</span>, <span class="st">"Gender"</span><span class="op">=</span><span class="va">gender</span>,</span>
<span>                    <span class="st">"Age"</span><span class="op">=</span><span class="va">age</span>, <span class="st">"Embarkment port"</span><span class="op">=</span><span class="va">embarked</span><span class="op">)</span></span></code></pre></div>
<p>Then we create a new CIU object that uses that vocabulary and get top-level explanation.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">titanic_ciu</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ciu.new.html">ciu.new</a></span><span class="op">(</span><span class="va">model_rf</span>, <span class="va">survived</span><span class="op">~</span><span class="va">.</span>, <span class="va">titanic_train</span>, vocabulary <span class="op">=</span> <span class="va">Titanic.voc</span><span class="op">)</span></span>
<span><span class="va">meta.top</span> <span class="op">&lt;-</span> <span class="va">titanic_ciu</span><span class="op">$</span><span class="fu">meta.explain</span><span class="op">(</span><span class="va">new_passenger</span><span class="op">[</span>,<span class="op">-</span><span class="fl">8</span><span class="op">]</span>, concepts.to.explain<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">Titanic.voc</span><span class="op">)</span>, n.samples <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span></code></pre></div>
<p>First barplot explanation:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">titanic_ciu</span><span class="op">$</span><span class="fu">ggplot.col.ciu</span><span class="op">(</span><span class="va">new_passenger</span><span class="op">[</span>,<span class="op">-</span><span class="fl">8</span><span class="op">]</span>, output.names <span class="op">=</span> <span class="st">"yes"</span>, ciu.meta <span class="op">=</span> <span class="va">meta.top</span>, plot.mode <span class="op">=</span> <span class="st">"overlap"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-9-1.png"><!-- --></p>
<p>Then explain WEALTH and FAMILY</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">titanic_ciu</span><span class="op">$</span><span class="fu">ggplot.col.ciu</span><span class="op">(</span><span class="va">new_passenger</span><span class="op">[</span>,<span class="op">-</span><span class="fl">8</span><span class="op">]</span>, ind.inputs <span class="op">=</span> <span class="va">Titanic.voc</span><span class="op">$</span><span class="va">FAMILY</span>, </span>
<span>                                 output.names <span class="op">=</span> <span class="st">"yes"</span>, target.concept <span class="op">=</span> <span class="st">"FAMILY"</span>, </span>
<span>                                 target.ciu <span class="op">=</span> <span class="va">meta.top</span><span class="op">$</span><span class="va">ciuvals</span><span class="op">[[</span><span class="st">"FAMILY"</span><span class="op">]</span><span class="op">]</span>, n.samples <span class="op">=</span> <span class="fl">100</span>, </span>
<span>                                 plot.mode <span class="op">=</span> <span class="st">"overlap"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-10-1.png"><!-- --></p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">titanic_ciu</span><span class="op">$</span><span class="fu">ggplot.col.ciu</span><span class="op">(</span><span class="va">new_passenger</span><span class="op">[</span>,<span class="op">-</span><span class="fl">8</span><span class="op">]</span>,ind.inputs <span class="op">=</span> <span class="va">Titanic.voc</span><span class="op">$</span><span class="va">WEALTH</span>, </span>
<span>                                 output.names <span class="op">=</span> <span class="st">"yes"</span>, target.concept <span class="op">=</span> <span class="st">"WEALTH"</span>, </span>
<span>                                 target.ciu <span class="op">=</span> <span class="va">meta.top</span><span class="op">$</span><span class="va">ciuvals</span><span class="op">[[</span><span class="st">"WEALTH"</span><span class="op">]</span><span class="op">]</span>, n.samples <span class="op">=</span> <span class="fl">100</span>,</span>
<span>                                 plot.mode <span class="op">=</span> <span class="st">"overlap"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-10-2.png"><!-- --></p>
<p>Same thing using textual explanations:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">titanic_ciu</span><span class="op">$</span><span class="fu">textual</span><span class="op">(</span><span class="va">new_passenger</span><span class="op">[</span>,<span class="op">-</span><span class="fl">8</span><span class="op">]</span>, use.text.effects <span class="op">=</span> <span class="cn">TRUE</span>, ind.output <span class="op">=</span> <span class="fl">2</span>, </span>
<span>                        ciu.meta <span class="op">=</span> <span class="va">meta.top</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="do">## The value of output 'yes' for instance '1' is 0.666, which is good (CU=0.666).</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Feature 'Age' is very important (CI=0.708) and value '8' is very good (CU=0.87).</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Feature 'FAMILY' is important (CI=0.55) and value is average (CU=0.593).</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Feature 'WEALTH' is slightly important (CI=0.39) and value is good (CU=0.61).</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Feature 'Gender' is slightly important (CI=0.278) and value 'male' is very bad (CU=0).</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Feature 'Embarkment port' is not important (CI=0.076) and value 'Cherbourg' is very good (CU=1).</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">titanic_ciu</span><span class="op">$</span><span class="fu">textual</span><span class="op">(</span><span class="va">new_passenger</span><span class="op">[</span>,<span class="op">-</span><span class="fl">8</span><span class="op">]</span>, use.text.effects <span class="op">=</span> <span class="cn">TRUE</span>, ind.output <span class="op">=</span> <span class="fl">2</span>, </span>
<span>                        ind.inputs <span class="op">=</span> <span class="va">Titanic.voc</span><span class="op">$</span><span class="va">FAMILY</span>, target.concept <span class="op">=</span> <span class="st">"FAMILY"</span>, </span>
<span>                        target.ciu <span class="op">=</span> <span class="va">meta.top</span><span class="op">$</span><span class="va">ciuvals</span><span class="op">[[</span><span class="st">"FAMILY"</span><span class="op">]</span><span class="op">]</span>, n.samples <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>,  <span class="st">"\n"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="do">## The value of intermediate concept 'FAMILY' for output 'yes', with instance '1' is average (CU=0.593).</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Feature 'sibsp' is important (CI=0.593) and value '0' is very good (CU=1).</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Feature 'parch' is important (CI=0.407) and value '0' is very bad (CU=0).</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">titanic_ciu</span><span class="op">$</span><span class="fu">textual</span><span class="op">(</span><span class="va">new_passenger</span><span class="op">[</span>,<span class="op">-</span><span class="fl">8</span><span class="op">]</span>, use.text.effects <span class="op">=</span> <span class="cn">TRUE</span>, ind.output <span class="op">=</span> <span class="fl">2</span>, </span>
<span>                        ind.inputs <span class="op">=</span> <span class="va">Titanic.voc</span><span class="op">$</span><span class="va">WEALTH</span>, target.concept <span class="op">=</span> <span class="st">"WEALTH"</span>, </span>
<span>                        target.ciu <span class="op">=</span> <span class="va">meta.top</span><span class="op">$</span><span class="va">ciuvals</span><span class="op">[[</span><span class="st">"WEALTH"</span><span class="op">]</span><span class="op">]</span>, n.samples <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="do">## The value of intermediate concept 'WEALTH' for output 'yes', with instance '1' is good (CU=0.61).</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Feature 'class' is important (CI=0.508) and value '1st' is good (CU=0.717).</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Feature 'fare' is slightly important (CI=0.379) and value '72' is good (CU=0.622).</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span></code></pre></div>
<div class="section level2">
<h2 id="ames-housing-example">Ames housing example<a class="anchor" aria-label="anchor" href="#ames-housing-example"></a>
</h2>
<p>Ames housing is a data set about properties in the town Ames in the US. It contains over 80 features that can be used for learning to estimate the sales price. The following code imports the data set, does some pre-processing and trains a Gradient Boosting model:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/topepo/AmesHousing" class="external-link">AmesHousing</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"AmesHousing"</span><span class="op">)</span></span>
<span><span class="va">ames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/AmesHousing/man/make_ames.html" class="external-link">make_ames</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Split into train/test data sets</span></span>
<span><span class="va">target</span> <span class="op">&lt;-</span> <span class="st">'Sale_Price'</span></span>
<span><span class="va">trainIdx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/createDataPartition.html" class="external-link">createDataPartition</a></span><span class="op">(</span><span class="va">ames</span><span class="op">[</span>,<span class="va">target</span><span class="op">]</span>, p<span class="op">=</span><span class="fl">0.8</span>, list<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">trainData</span> <span class="op">=</span> <span class="va">ames</span><span class="op">[</span><span class="va">trainIdx</span>,<span class="op">]</span></span>
<span><span class="va">testData</span> <span class="op">=</span> <span class="va">ames</span><span class="op">[</span><span class="op">-</span><span class="va">trainIdx</span>,<span class="op">]</span></span>
<span></span>
<span><span class="co"># Train (this will take a while!)</span></span>
<span><span class="va">kfoldcv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html" class="external-link">trainControl</a></span><span class="op">(</span>method<span class="op">=</span><span class="st">"cv"</span>, number<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">exec.time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span></span>
<span>  <span class="va">Ames.gbm</span> <span class="op">&lt;&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html" class="external-link">train</a></span><span class="op">(</span><span class="va">Sale_Price</span><span class="op">~</span><span class="va">.</span>, <span class="va">trainData</span>, method<span class="op">=</span><span class="st">"gbm"</span>, trControl<span class="op">=</span><span class="va">kfoldcv</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Training set performance (remember that prices are high, so RMSE will be high too!)</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">Ames.gbm</span>, newdata<span class="op">=</span><span class="va">trainData</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Training set RMSE:"</span>, <span class="fu"><a href="https://rdrr.io/pkg/caret/man/postResample.html" class="external-link">RMSE</a></span><span class="op">(</span><span class="va">trainData</span><span class="op">$</span><span class="va">Sale_Price</span>, <span class="va">res</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Test set performance (remember that prices are high, so RMSE will be high too!)</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">Ames.gbm</span>, newdata<span class="op">=</span><span class="va">testData</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Test set RMSE:"</span>, <span class="fu"><a href="https://rdrr.io/pkg/caret/man/postResample.html" class="external-link">RMSE</a></span><span class="op">(</span><span class="va">testData</span><span class="op">$</span><span class="va">Sale_Price</span>, <span class="va">res</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We create our vocabulary (only two levels this time) and initialize CIU object:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Ames.voc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"Garage"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">58</span>,<span class="fl">59</span>,<span class="fl">60</span>,<span class="fl">61</span>,<span class="fl">62</span>,<span class="fl">63</span><span class="op">)</span>, </span>
<span>  <span class="st">"Basement"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">30</span>,<span class="fl">31</span>,<span class="fl">33</span>,<span class="fl">34</span>,<span class="fl">35</span>,<span class="fl">36</span>,<span class="fl">37</span>,<span class="fl">38</span>,<span class="fl">47</span>,<span class="fl">48</span><span class="op">)</span>, </span>
<span>  <span class="st">"Lot"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">7</span>,<span class="fl">8</span>,<span class="fl">9</span>,<span class="fl">10</span>,<span class="fl">11</span><span class="op">)</span>, </span>
<span>  <span class="st">"Access"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">13</span>,<span class="fl">14</span><span class="op">)</span>,</span>
<span>  <span class="st">"House type"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">15</span>,<span class="fl">16</span>,<span class="fl">21</span><span class="op">)</span>, </span>
<span>  <span class="st">"House aesthetics"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">22</span>,<span class="fl">23</span>,<span class="fl">24</span>,<span class="fl">25</span>,<span class="fl">26</span><span class="op">)</span>, </span>
<span>  <span class="st">"House condition"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">17</span>,<span class="fl">18</span>,<span class="fl">19</span>,<span class="fl">20</span>,<span class="fl">27</span>,<span class="fl">28</span><span class="op">)</span>,</span>
<span>  <span class="st">"First floor surface"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">43</span><span class="op">)</span>, </span>
<span>  <span class="st">"Above ground living area"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">ames</span><span class="op">)</span><span class="op">==</span><span class="st">"Gr_Liv_Area"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Ames.voc_ciu</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ciu.new.html">ciu.new</a></span><span class="op">(</span><span class="va">Ames.gbm</span>, <span class="va">Sale_Price</span><span class="op">~</span><span class="va">.</span>, <span class="va">trainData</span>, vocabulary <span class="op">=</span> <span class="va">Ames.voc</span><span class="op">)</span></span></code></pre></div>
<p>We start with an “explanation” using all 80 basic features, which is not very readable and overly detailed for “ordinary” humans to understand:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># We take an expensive house</span></span>
<span><span class="va">inst.ind</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">testData</span><span class="op">$</span><span class="va">Sale_Price</span><span class="op">&gt;</span><span class="fl">500000</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">instance</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">testData</span><span class="op">[</span><span class="va">inst.ind</span>,<span class="op">]</span>, select<span class="op">=</span><span class="op">-</span><span class="va">Sale_Price</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Explain</span></span>
<span><span class="va">Ames_ciu.meta</span> <span class="op">&lt;-</span> <span class="va">Ames.voc_ciu</span><span class="op">$</span><span class="fu">meta.explain</span><span class="op">(</span><span class="va">instance</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">Ames.voc_ciu</span><span class="op">$</span><span class="fu">ggplot.col.ciu</span><span class="op">(</span><span class="va">instance</span>, ciu.meta<span class="op">=</span><span class="va">Ames_ciu.meta</span>, plot.mode <span class="op">=</span> <span class="st">"overlap"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="st">""</span>, x <span class="op">=</span><span class="st">""</span>, y<span class="op">=</span><span class="st">"CI"</span>, fill<span class="op">=</span><span class="st">"CU"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-13-1.png"><!-- --></p>
<p>Then the same, using highest-level concepts:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">meta.top</span> <span class="op">&lt;-</span> <span class="va">Ames.voc_ciu</span><span class="op">$</span><span class="fu">meta.explain</span><span class="op">(</span><span class="va">instance</span>, concepts.to.explain<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">Ames.voc</span><span class="op">)</span>, </span>
<span>                                      n.samples <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">Ames.voc_ciu</span><span class="op">$</span><span class="fu">ggplot.col.ciu</span><span class="op">(</span><span class="va">instance</span>, concepts.to.explain<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">Ames.voc</span><span class="op">)</span>, </span>
<span>                                  plot.mode <span class="op">=</span> <span class="st">"overlap"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-14-1.png"><!-- --></p>
<p>Then explain further some intermediate concepts:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># House condition</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">Ames.voc_ciu</span><span class="op">$</span><span class="fu">ggplot.col.ciu</span><span class="op">(</span><span class="va">instance</span>, ind.inputs <span class="op">=</span> <span class="va">Ames.voc</span><span class="op">$</span><span class="va">`House condition`</span>, </span>
<span>                                  target.concept <span class="op">=</span> <span class="st">"House condition"</span>, plot.mode <span class="op">=</span> <span class="st">"overlap"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/ames_subeplanations-1.png"><!-- --></p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Basement</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">Ames.voc_ciu</span><span class="op">$</span><span class="fu">ggplot.col.ciu</span><span class="op">(</span><span class="va">instance</span>, ind.inputs <span class="op">=</span> <span class="va">Ames.voc</span><span class="op">$</span><span class="va">Basement</span>, </span>
<span>                                  target.concept <span class="op">=</span> <span class="st">"Basement"</span>, plot.mode <span class="op">=</span> <span class="st">"overlap"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/ames_subeplanations-2.png"><!-- --></p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Garage</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">Ames.voc_ciu</span><span class="op">$</span><span class="fu">ggplot.col.ciu</span><span class="op">(</span><span class="va">instance</span>, ind.inputs <span class="op">=</span> <span class="va">Ames.voc</span><span class="op">$</span><span class="va">Garage</span>, </span>
<span>                                  target.concept <span class="op">=</span> <span class="st">"Garage"</span>, plot.mode <span class="op">=</span> <span class="st">"overlap"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/ames_subeplanations-3.png"><!-- --></p>
<p>This vocabulary is just an example of what kind of concepts a human typically deals with. Vocabularies can be built freely (or learned, if possible) and used freely, even so that different vocabularies can be used with different users.</p>
</div>
</div>
<div class="section level1">
<h1 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h1>
<p><code>ciu</code> is available from CRAN at <a href="https://cran.r-project.org/web/packages/ciu/index.html" class="external-link uri">https://cran.r-project.org/web/packages/ciu/index.html</a> and can be installed using the standard <code>install.packages("ciu")</code> command.</p>
<p>However, in order to use the latest developments, <code>ciu</code> can be installed directly from Github with the commands</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages('devtools') # Uncomment if devtools wasn't installed already</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">'KaryFramling/ciu'</span><span class="op">)</span></span></code></pre></div>
<p><strong>Remark</strong>: If you get an error about inconsistency in Help file database, then restart R. This seems to happen if first removing <code>ciu</code> and then doing the install straight after. Apparently the un-install temporarily messes up the help database and this is not specific to <code>ciu</code>.</p>
</div>
<div class="section level1">
<h1 id="miscellaneous">Miscellaneous<a class="anchor" aria-label="anchor" href="#miscellaneous"></a>
</h1>
<p>The examples and code snippets shown here only show the main capabilities of CIU and this implementation. Here’s a short list of miscellaneous other features of “good to know” information.</p>
<div class="section level2">
<h2 id="various-examples-and-test-cases">Various examples and test cases<a class="anchor" aria-label="anchor" href="#various-examples-and-test-cases"></a>
</h2>
<p>The file <a href="TestCases.R"><code>TestCases.R</code></a> contains functions for running and testing CIU with numerous functions and data sets (Iris, Boston, Heart Disease, UCI Cars, Diamonds, Titanic, Adult, Ames housing, etc.) and machine learning models (lda, Random Forest, GBM).</p>
</div>
<div class="section level2">
<h2 id="support-for-different-aiml-models">Support for different AI/ML models<a class="anchor" aria-label="anchor" href="#support-for-different-aiml-models"></a>
</h2>
<p>For the moment, any <code>caret</code> model should work (and most of them have been tested). Any <code>mlr3</code>model should also work but only <code>classif.rpart</code>has been tested. The <code>MASS:lda</code> and <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">stats::lm</a></code> models are also supported. Other models might work directly also, the default behaviour is to call <code>pred &lt;- predict(model,inputs)</code> and retrieve result from <code>pred$posterior</code>.</p>
<p>For any other models, the prediction function to be use can be given as value of the <code>predict.function</code> argument of <code>ciu.new</code> method. For instance, for <code>mlr3</code> a function <code>predf.ciu &lt;- function(m, newdata) { m$predict_newdata(newdata)$prob }</code> is sufficient.</p>
<p>Additionally, any object that implements the <code>CIU.BlackBox</code> interface with an <code>eval</code> function is automatically supported. The template for creating such a class looks as follows and examples are provided in the package’s documentation (do <code><a href="reference/ciu.blackbox.new.html">?ciu.blackbox.new</a></code>).</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ciu.blackbox.new</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>eval <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">inputs</span><span class="op">)</span> <span class="op">{</span> <span class="cn">NULL</span> <span class="op">}</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CIU.BlackBox"</span>, <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="using-old-r-plot-functions">Using old R “plot” functions<a class="anchor" aria-label="anchor" href="#using-old-r-plot-functions"></a>
</h2>
<p>Some plotting functions are implemented that use R’s plain graphics:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ciu</span><span class="op">$</span><span class="fu">barplot.ciu</span><span class="op">(</span><span class="va">new_passenger</span>, ind.output <span class="op">=</span> <span class="fl">2</span>, sort <span class="op">=</span> <span class="st">"CI"</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-15-1.png"><!-- --></p>
<p>There is also a method called pie.ciu that visualizes CIU using a pie chart, produced just by replacing <code>ciu@barplot.ciu</code> with <code>ciu@pie.ciu</code>.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ciu</span><span class="op">$</span><span class="fu">pie.ciu</span><span class="op">(</span><span class="va">new_passenger</span>, ind.output <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-16-1.png"><!-- --></p>
<p>However, these functions can be considered deprecated and will presumably not be developed further.</p>
</div>
</div>
<div class="section level1">
<h1 id="related-resources">Related resources<a class="anchor" aria-label="anchor" href="#related-resources"></a>
</h1>
<p>A Python version that (attempts to) provide similar functionality as this R package is available at <a href="https://github.com/KaryFramling/py-ciu" class="external-link uri">https://github.com/KaryFramling/py-ciu</a>. An older version is available at <a href="https://github.com/TimKam/py-ciu" class="external-link uri">https://github.com/TimKam/py-ciu</a> but it is not maintained nor updated anymore.</p>
<p>There are also two implementations of CIU for explaining images:</p>
<ul>
<li><p>R: <a href="https://github.com/KaryFramling/ciu.image" class="external-link uri">https://github.com/KaryFramling/ciu.image</a></p></li>
<li><p>Python: <a href="https://github.com/KaryFramling/py.ciu.image" class="external-link uri">https://github.com/KaryFramling/py.ciu.image</a></p></li>
</ul>
<p>Image explanation packages can be considered to be at proof-of-concept level (Nov. 2022). Future work on image explanation will presumably focus on the Python version, due to the extensive use of deep neural networks that tend to be implemented mainly for Python.</p>
</div>
<div class="section level1">
<h1 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h1>
<p>The use of this package is described in <em>FRÄMLING, Kary. Contextual Importance and Utility in R: the ‘ciu’ Package. In: Proceedings of 1st Workshop on Explainable Agency in Artificial Intelligence, at 35th AAAI Conference on Artificial Intelligence. Virtual, Online. February 8-9, 2021. pp. 110-114.</em>, accessible at <a href="http://www.cs.hut.fi/~framling/Publications/CIU_XAI_WS_AAAI2021.pdf" class="external-link uri">http://www.cs.hut.fi/~framling/Publications/CIU_XAI_WS_AAAI2021.pdf</a>.</p>
<p>The first publication on CIU was in the ICANN conference in Paris in 1995: <em>FRÄMLING, Kary, GRAILLOT, Didier. Extracting Explanations from Neural Networks. ICANN’95 proceedings, Vol. 1, Paris, France, 9-13 October, 1995. Paris: EC2 &amp; Cie, 1995. pp. 163-168.</em>, accessible at <a href="http://www.cs.hut.fi/~framling/Publications/CIU_XAI_WS_AAAI2021.pdf" class="external-link">http://www.cs.hut.fi/u/framling/Publications/FramlingIcann95.pdf</a>.</p>
<p>The second publication, and last before “hibernation” of CIU research, is <em>FRÄMLING, Kary. Explaining Results of Neural Networks by Contextual Importance and Utility. Proceedings of the AISB’96 conference, 1-2 April 1996. Brighton, UK, 1996.</em>, accessible at <a href="http://www.cs.hut.fi/~framling/Publications/CIU_XAI_WS_AAAI2021.pdf" class="external-link">http://www.cs.hut.fi/u/framling/Publications/FramlingAisb96.pdf</a>.</p>
</div>
<div class="section level1">
<h1 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a>
</h1>
<p><a href="http://github.com/KaryFramling" class="external-link">Kary Främling</a></p>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=ciu" class="external-link">View on CRAN</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li>
<a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a>
</li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing ciu</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Kary Främling <br><small class="roles"> Maintainer </small>  </li>
</ul>
</div>



  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by Kary Främling.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
